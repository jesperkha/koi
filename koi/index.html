
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.3">
    
    
      
        <title>The Koi programming language - Koi Wiki</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#the-koi-programming-language" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Koi Wiki" class="md-header__button md-logo" aria-label="Koi Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Koi Wiki
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              The Koi programming language
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Koi Wiki" class="md-nav__button md-logo" aria-label="Koi Wiki" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Koi Wiki
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    About
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Getting Started
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Getting Started
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getstarted/create_project/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Creating a Project
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../getstarted/hello_world/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Hello World
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Documentation
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Documentation
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../docs/main/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Main Function
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Examples
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            
  
    Examples
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/work_with_c/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Working with C
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-koi" class="md-nav__link">
    <span class="md-ellipsis">
      
        About Koi
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#table-of-contents" class="md-nav__link">
    <span class="md-ellipsis">
      
        Table of contents
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#basic-semantics-syntax-and-more" class="md-nav__link">
    <span class="md-ellipsis">
      
        Basic semantics, syntax, and more
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Basic semantics, syntax, and more">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#hello-world" class="md-nav__link">
    <span class="md-ellipsis">
      
        Hello world
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#comments" class="md-nav__link">
    <span class="md-ellipsis">
      
        Comments
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#packages" class="md-nav__link">
    <span class="md-ellipsis">
      
        Packages
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#main-function" class="md-nav__link">
    <span class="md-ellipsis">
      
        Main function
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    <span class="md-ellipsis">
      
        Functions
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#no-semicolons" class="md-nav__link">
    <span class="md-ellipsis">
      
        No semicolons
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#strings" class="md-nav__link">
    <span class="md-ellipsis">
      
        Strings
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#numbers-and-booleans" class="md-nav__link">
    <span class="md-ellipsis">
      
        Numbers and booleans
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#variables-and-constants" class="md-nav__link">
    <span class="md-ellipsis">
      
        Variables and constants
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#arrays" class="md-nav__link">
    <span class="md-ellipsis">
      
        Arrays
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#structs" class="md-nav__link">
    <span class="md-ellipsis">
      
        Structs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#struct-methods" class="md-nav__link">
    <span class="md-ellipsis">
      
        Struct methods
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#tuples" class="md-nav__link">
    <span class="md-ellipsis">
      
        Tuples
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      
        Interfaces
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#error-interface" class="md-nav__link">
    <span class="md-ellipsis">
      
        Error interface
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#throw-and-catch" class="md-nav__link">
    <span class="md-ellipsis">
      
        Throw and catch
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-and-operators" class="md-nav__link">
    <span class="md-ellipsis">
      
        The ? and ?? operators
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#ownership" class="md-nav__link">
    <span class="md-ellipsis">
      
        Ownership
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#pointer-lifetimes" class="md-nav__link">
    <span class="md-ellipsis">
      
        Pointer lifetimes
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="the-koi-programming-language">The Koi programming language</h1>
<h2 id="about-koi">About Koi</h2>
<p>Koi is a statically typed, compiled language, made as an attempt to make a modern version of C. It keeps all the low level control and improves syntax and code writing ergonomics.</p>
<h2 id="table-of-contents">Table of contents</h2>
<h2 id="basic-semantics-syntax-and-more">Basic semantics, syntax, and more</h2>
<h3 id="hello-world">Hello world</h3>
<pre><code class="language-go">package main

func main() int {
    println(&quot;Hello, world!&quot;)
    return 0
}
</code></pre>
<h3 id="comments">Comments</h3>
<pre><code class="language-go">// Single line comment

/*
    Multi-line comment
*/
</code></pre>
<h3 id="packages">Packages</h3>
<p>Before you can write any code you must declare what package the file belongs to. A package declares a translation unit in compilation. Because of this, packages can be compiled seperately and used as dynamic/static libraries.</p>
<pre><code class="language-go">package main // Main package. Contains entry point.
</code></pre>
<pre><code class="language-go">// A user package. All files in the same directory with the same
// package declaration will be part of the same translation unit.
package user
</code></pre>
<h3 id="main-function">Main function</h3>
<p>You must declare a main function in the main package. This is the programs entry point. The returned integer is the programs exit code.</p>
<pre><code class="language-go">package main

// main must have this exact function signature
func main() int {
    return 0 // Exit code 0
}
</code></pre>
<h3 id="functions">Functions</h3>
<p>Functions are declared similar to Go, using the <code>func</code> keyword. The return type is specified after the parameter list. Functions that do not return a value must still declare that with the <code>void</code> return type.</p>
<pre><code class="language-go">// Return sum of two integers.
func add(a int, b int) int {
    return a + b
}

// Say hello. Has no return value.
func sayHello() void {
    println(&quot;Hello!&quot;)
}
</code></pre>
<h3 id="no-semicolons">No semicolons</h3>
<p>Koi does not use semicolons and is therefore whitespace sensitive, to an extent. Statements end with a newline or a right brace <code>}</code>.</p>
<pre><code class="language-go">// Valid
func double(n int) int { return n * 2 }

// Error
func addOne(n int) int { n += 1 return n }
//                             ^ expected end of statement
</code></pre>
<h3 id="strings">Strings</h3>
<p>Strings literals are static arrays of bytes. They are enclosed in double quotes <code>"</code>. Character (byte) literals are written with single quotes <code>'</code>. Special characters are escaped with a backslash <code>\</code>.</p>
<pre><code class="language-go">&quot;Hello&quot;

&quot;a&quot; // String
'a' // Byte

'\n' // newline

len(&quot;Bob&quot;) // 3
</code></pre>
<h3 id="numbers-and-booleans">Numbers and booleans</h3>
<p>Integer literals default to a 32-bit signed integer <code>i32</code>. Number literals with a decimal point default to a 32-bit float <code>f32</code>. Boolean values are either <code>true</code> or <code>false</code>. They are their own type and cannot be compared with numbers.</p>
<pre><code class="language-go">2   // i32
2.0 // f32

true == 1 // error: mismatched types in comparison
</code></pre>
<h3 id="variables-and-constants">Variables and constants</h3>
<p>Variables are declared with the <code>:=</code> operator. The type is inferred from the value. Assignment uses the <code>=</code> operator. Variables can only be assigned values of its declared type. Constants are declared with the <code>::</code> operator. You can specify the type by passing it before either operator.</p>
<pre><code class="language-go">age := 10      // Declare variable age of type int
name :: &quot;John&quot; // Declare a constant name with the value John.

age = 11        // Assign new value to age
name = &quot;David&quot;  // error: cannot assign to constant

number int := 32       // Specify type in declaration
name const string :: &quot;John&quot;  // Same but constant
</code></pre>
<p>Constant strings and arrays are put in the data section during compilation.</p>
<pre><code class="language-go">animal := &quot;Cat&quot; // Allcated on the stack during runtime
animal :: &quot;Dog&quot; // Statically stored in data section of binary
</code></pre>
<h3 id="arrays">Arrays</h3>
<pre><code class="language-rs">// The type is inferred from the first element
fruits := {&quot;Banana&quot;, &quot;Apple&quot;, &quot;Orange&quot;} // type is []string

// Specify type of array two ways
numbers []u8 := {1, 2, 3}
numbers := {1 as u8, 2, 3}

len(numbers) // 3
</code></pre>
<h3 id="structs">Structs</h3>
<pre><code class="language-go">struct Person {
    name string
    age  int
}

func f() {
    john := Person{name: &quot;John&quot;, age: 32}
    println(john.name) // John
}
</code></pre>
<h3 id="struct-methods">Struct methods</h3>
<pre><code class="language-go">struct Dog {
    name string

    func bark() {
        // self is a reference to this Dog instance
        // and is available in all struct methods
        println(&quot;woof woof my name is {}&quot;, self.name)
    }
}

func f() {
    buddy := Dog{name: &quot;Buddy&quot;}
    buddy.bark() // woof woof my name is Buddy
}
</code></pre>
<pre><code class="language-go">struct Account {
    holder  string
    balance f64
    debt    f64

    // Use the 'meta' keyword to make a method globally accessible through the
    // Account type. The 'self' keyword is not available in meta methods.
    meta func new(name string) Account {
        return Account{
            holder: name,
            balance: 0,
            debt: 0,
        }
    }
}

func f() {
    acc := Account.new(&quot;James&quot;)
    acc.new() // error: 'new' is a meta method on 'Account' and
              // is not available to 'Account' instances
}
</code></pre>
<h3 id="tuples">Tuples</h3>
<pre><code class="language-go">tuple Podium {
    string
    string
    string
}

func f() {
    p := Podium(&quot;John&quot;, &quot;Mary&quot;, &quot;Bob&quot;)

    println(p.0) // John
    println(p.1) // Mary
    println(p.2) // Bob
}
</code></pre>
<h3 id="interfaces">Interfaces</h3>
<pre><code class="language-go">interface Named {
    name() string
}

struct Person is Named {
    name string

    func name() string {
        return self.name
    }
}

// Using multiple interfaces
struct File is Writer, Reader, Closer {
    ...
}
</code></pre>
<h3 id="error-interface">Error interface</h3>
<pre><code class="language-go">// Special builtin interface
interface Error {
    error() string
}
</code></pre>
<pre><code class="language-go">tuple SyntaxError is Error {
    string
    int

    func error() string {
        return fmt(&quot;syntax error: {}, line {}&quot;, self.0, self.1)
    }
}

func f() error {
    throw SyntaxError(&quot;missing semicolon&quot;, 21)
}
</code></pre>
<pre><code class="language-go">// Builtin Err type
tuple Err is Error {
    string

    func error() string {
        return self.0
    }
}
</code></pre>
<h3 id="throw-and-catch">Throw and catch</h3>
<pre><code class="language-go">// This function either returns a float or throws an error
func divide(a float, b float) float | error {
    if b == 0 {
        throw Err(&quot;cannot divide by 0&quot;)
    }
    return a / b
}

func example() {
    // An error is raised here and we print it out.
    // result will be given a default value
    // (0 in this case as it is the default for float)
    result := divide(3, 0) catch err {
        println(&quot;oops, got error: {}&quot;, err)
    }
}

func example() {
    result := divide(8, 2) // error: error must be handled
}
</code></pre>
<h3 id="the-and-operators">The <code>?</code> and <code>??</code> operators</h3>
<pre><code class="language-go">func example() error {
    // ? operator just throws the error again
    result := divide(1, 0)?

    // shorthand for this
    result := divide(1, 0) catch err {
        throw err
    }
}

func example() error {
    // ?? operator panics if an error is thrown
    result := divide(1, 0)??

    // shorthand for this
    result := divide(1, 0) catch err {
        panic(&quot;{}&quot;, err)
    }
}
</code></pre>
<h3 id="ownership">Ownership</h3>
<p>Koi uses ownership rules to improve code readability and maintance when dealing with pointers and memory. There are only a few rules that govern ownership:</p>
<ol>
<li>A pointer must have an owner.</li>
<li>You must pass on the ownership of a pointer in the same scope you acquired it.</li>
<li>You cannot assign to a variable owning a pointer before giving up ownership.</li>
</ol>
<p>Koi uses the <code>!</code> symbol to denote ownership of a pointer. Note that <strong>this is not a type</strong>, but rather an indicator saying "you now own this pointer".</p>
<p>Simplest example:</p>
<pre><code class="language-go">func example() void {
    // Allocate number on the heap.
    // number now owns the pointer to that memory
    number: *int = alloc(int, 1);
    //          ^ note that there is no ! here because, again, *its not a type*

    println(&quot;My favorite number is {}&quot;, *number);

    // Using ! to pass along ownership of number
    free(number!)

    *number += 1 // This will raise a compilation error as number
                 // is used after ownership is passed on
}
</code></pre>
<p>Explanation of rule 3:</p>
<pre><code class="language-go">func example() void {
    mem := alloc([32]byte) // mem owns the pointer returned

    // Error. Cannot assign to a variable before passing on ownership
    mem = alloc([64]byte)

    // Ok
    mem = realloc(mem!, [64]byte)

    // Error. Ownership of mem was never passed on
}
</code></pre>
<h3 id="pointer-lifetimes">Pointer lifetimes</h3>
<p>Ownership can be artificially created and destroyed with the respective <code>own()</code> and <code>end()</code> builtin functions. They are both 'magic' functions as they are technically disallowed by the compiler. They serve no purpose other than to open and close the ownership loop (mostly used when creating custom allocators).</p>
<pre><code class="language-go">// Returns the same pointer, but now owned.
func own(ptr *void) *void!

// Takes final ownership of a pointer and does nothing.
func end(ptr *void!)
</code></pre>
<p><code>alloc()</code> and <code>free()</code> are implemented using them:</p>
<pre><code class="language-go">func alloc(t type) *void! {
    // ...acquire memory using syscalls etc...
    ptr := ...

    return own(ptr)
}

// Takes final ownership of a pointer and does nothing.
func free(ptr *void!) {
    // ...mark memory as freed and do other stuff...

    end(ptr)
}
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": ["content.code.copy", "navigation.footer"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
    
  </body>
</html>